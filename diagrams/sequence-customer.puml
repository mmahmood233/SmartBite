@startuml Customer Place Order
!theme plain

title Wajba - Customer Place Order Sequence Diagram

actor Customer
participant "Mobile App" as App
participant "Supabase Auth" as Auth
participant "Supabase DB" as DB
participant "Payment Gateway" as Payment

Customer -> App: Open App
App -> Auth: Check Session

alt Not Logged In
    App -> Customer: Show Login
    Customer -> App: Enter Credentials
    App -> Auth: signInWithPassword()
    Auth --> App: Session Token
end

Customer -> App: Browse Restaurants
App -> DB: SELECT * FROM restaurants
DB --> App: Restaurant List
App --> Customer: Display Restaurants

Customer -> App: Select Restaurant
App -> DB: SELECT * FROM menu_items
DB --> App: Menu Items
App --> Customer: Display Menu

Customer -> App: Add to Cart
App -> App: Update Local Cart State

Customer -> App: Proceed to Checkout
App --> Customer: Show Checkout

Customer -> App: Select Address
Customer -> App: Choose Payment Method

alt Pay with Card
    App -> Payment: Process Payment
    Payment --> App: Payment Success
else Cash on Delivery
    App -> App: Set COD
end

Customer -> App: Place Order
App -> DB: INSERT INTO orders
DB --> App: Order Created
DB -> DB: Trigger: Notify Restaurant
App --> Customer: Order Confirmation

Customer -> App: Track Order
App -> DB: Subscribe to order changes
DB --> App: Real-time Updates
App --> Customer: Show Status

@enduml
