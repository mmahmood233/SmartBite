@startuml Rider Order Delivery
!theme plain

title Wajba - Rider Order Delivery Sequence Diagram

actor Rider
participant "Rider App" as App
participant "Supabase Auth" as Auth
participant "Supabase DB" as DB

Rider -> App: Login
App -> Auth: signInWithPassword()
Auth --> App: Session Token
App --> Rider: Show Dashboard

Rider -> App: View Available Orders
App -> DB: SELECT * FROM deliveries WHERE status = 'pending'
DB --> App: Available Orders
App --> Rider: Display Orders

Rider -> App: Accept Delivery
App -> DB: UPDATE deliveries SET rider_id = ?, status = 'assigned'
DB --> App: Order Assigned
DB -> DB: Trigger: Notify Customer
App --> Rider: Delivery Accepted

== Status Flow ==

Rider -> App: Heading to Restaurant
App -> DB: UPDATE status = 'heading_to_restaurant'
App -> DB: INSERT INTO rider_location_tracking
DB --> App: Updated

Rider -> App: Arrived at Restaurant
App -> DB: UPDATE status = 'arrived_at_restaurant'
DB --> App: Updated

Rider -> App: Pick Up Order
App -> DB: UPDATE status = 'picked_up'
DB --> App: Updated
DB -> DB: Trigger: Notify Customer

Rider -> App: Heading to Customer
App -> DB: UPDATE status = 'heading_to_customer'
App -> DB: INSERT INTO rider_location_tracking
DB --> App: Updated

Rider -> App: Arrived at Customer
App -> DB: UPDATE status = 'arrived_at_customer'
DB --> App: Updated

Rider -> App: Mark as Delivered
App -> DB: UPDATE status = 'delivered'
App -> DB: UPDATE orders SET status = 'delivered'
App -> DB: UPDATE rider earnings
DB --> App: Delivery Complete
DB -> DB: Trigger: Notify Customer
App --> Rider: Earnings Updated

Rider -> App: View Earnings
App -> DB: SELECT * FROM rider_earnings
DB --> App: Earnings Data
App --> Rider: Display Earnings

@enduml
